---
title: "Coursera 5-2 Project 1"
author: "KUrgent"
date: "1/4/2020"
output:
  md_document:
  variant: markdown_github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = 'asis', fig.show = 'asis',warning = TRUE)
```

First load necessary packages.  
```{r packages}

setwd("~/coursera/5. Reproducible Research/Wk 2/HW")

library(dplyr)
library(tidyr)
library(knitr)
library(markdown)
library(ggplot2)
```
Load the data (read.csv) 
```{r, echo=TRUE,results='asis'}
activity <- read.csv("activity.csv")
```
Q1 What is the mean total number of steps taken per day?  
For this part, missing values in the dataset are ignored.  

Reshape the dataset to a dataframe which has means of the total steps per day. 
And call the object, "stepbydate.  
Also, make sure that data in date is formatted as date.

```{r, echo=TRUE,results='asis'}
stepsbydate <- activity %>%
        group_by(date) %>%
        summarise(ttl.steps = sum(steps,na.rm = TRUE)) %>%
        mutate(date = as.Date(date,"%Y-%m-%d"))
```

Find out the mean and median of steps taken by day, using summary function.  

```{r,, echo=TRUE,results='asis'}
summary(stepsbydate)
```

Make a histogram of the total number of steps taken by day. 
```{r,echo=TRUE}
h <- ggplot(data = stepsbydate,aes(x=ttl.steps)) +
        geom_histogram(binwidth = 1000,
                       col = "green",fill = "green", alpha = 0.5) +
  geom_vline(aes(xintercept = mean(ttl.steps)),col='red',size=1)+ #add a line to show mean
  geom_vline(aes(xintercept = median(ttl.steps)),col='blue',size=1)+ #add a line to show median
  geom_text(aes(label=round(mean(ttl.steps),0),y=10,x=8500),
            vjust=1,col='red',size=4) + #add the mean value
  geom_text(aes(label=round(median(ttl.steps),0),y=10,x=11500),
          vjust=1,col='blue',size=4) + #add the median value
  geom_text(aes(label="(mean)",y=9,x=8500),
            vjust=1,col='red',size=3) + # label the mean value
  geom_text(aes(label="(median)",y=9,x=11500),
            vjust=1,col='blue',size=3) +  #label the median value
  xlab("total steps per day")
  
h
```

Project1 - Q2  
What is the average daily activity pattern?  

Find the how many days in the "activity"data.

```{r,, echo=TRUE,results='asis'}
length(unique(stepsbydate$date))
```

To make a time series plot of the 5-minute interval (x-axis) and the average number of steps taken,averaged across all days (y-axis), create a dataset called "activity2".

```{r,, echo=TRUE,results='asis'}
activity2 <- activity %>%
  group_by(interval)%>%
  summarise(ttl.steps = sum(steps,na.rm = TRUE))%>% 
  mutate(avesteps = ttl.steps/61)
```

Plot "activity2".

```{r,echo=TRUE,results='asis'}
q2 <- ggplot(data = activity2,aes(x = interval, y = avesteps)) + 
  geom_line(size = 0.5,na.rm = TRUE) +
  ylab("Average Numbers of Steps taken")
              
q2
```

To find which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps,  
1. First, find the maximum value of average steps from the dataset  
2. Filter the dataset using the velue from #1

```{r,echo=TRUE,results='asis'}
maxave <-  max(activity2$avesteps, na.rm = TRUE)

maxinterval <- activity2 %>%
  filter(avesteps == max(avesteps, na.rm = TRUE)) %>%
  subset(select = interval)

maxinterval
```

So, the interval, 835 has the maximum number of steps, on average across all the days
in the dataset.

Now the missing data will be imputed by the mean number of steps for the interval. 

Count the number of "NA" in column "steps", "date", "interval".

```{r, echo=TRUE,results='asis'}
sum(is.na(activity$steps))
sum(is.na(activity$date))
sum(is.na(activity$interval))
```

So we know that only "steps' column contains NA.  
There are **`r sum(is.na(activity$steps))`** missing values in the column.

First replace NA with "0" so that "aggregate' function can be used.  
```{r, echo=TRUE,results='asis'}
XnoNA <- activity %>%
  mutate(steps = ifelse(is.na(steps),0,steps))
```

Make a table showing mean # of steps by each interval and saved it in a data frame
called **"meanbyinterval"**.  We will replace any missing data in "steps" column with the mean number of steps for an equivalent interval.


```{r, echo=TRUE,results='asis'}
meanbyinterval <- aggregate(XnoNA[,1],list(XnoNA$interval),mean)
meanbyinterval <- meanbyinterval%>%
  rename(interval = Group.1, mean.steps = x)
```

Make a imputed list
 1.create a new column for interval mean for each interval (auto name = mean.steps)
 2.create a new column which shows each interval's mean steps
if steps  = NA (missing value), or else, leave as they are

```{r, echo=TRUE,results='asis'}
imputed <- activity %>%
  inner_join(meanbyinterval, by = "interval") %>%
  mutate(steps = ifelse(is.na(steps),mean.steps,steps))
```

To make a histogram of the total number of steps taken each day,
again create a data frame showing ttl steps by date.
We call this object as "stepbydate2".  

```{r, echo=TRUE,results='asis'}
stepsbydate2 <- imputed %>%
  group_by(date) %>%
  summarise(ttl.steps = sum(steps)) %>%
  mutate(date = as.Date(date,"%Y-%m-%d"))
```

Find out the mean and median total number of steps taken per day.
```{r, echo=TRUE,results='asis'}
summary(stepsbydate2)
```


Then make a histogram of ttl number of steps per day.

```{r, echo=TRUE,results='asis'}
h3 <- ggplot(data = stepsbydate2,aes(x=ttl.steps)) +
  geom_histogram(binwidth = 1000,
                 col = "green",fill = "green", alpha = 0.5) +
  geom_vline(aes(xintercept = mean(ttl.steps)),col='red',size=1)+ #add a line to show mean
  geom_vline(aes(xintercept = median(ttl.steps)),col='blue',size=1)+ #add a line to show median
  geom_text(aes(label=round(mean(ttl.steps),0),y=10,x=8500),
            vjust=1,col='red',size=4) + #add the mean value
  geom_text(aes(label=round(median(ttl.steps),0),y=10,x=11500),
            vjust=1,col='blue',size=4) + #add the median value
  geom_text(aes(label="(mean)",y=9,x=8500),
            vjust=1,col='red',size=3) + # label the mean value
  geom_text(aes(label="(median)",y=9,x=11500),
            vjust=1,col='blue',size=3) +  #label the median value
  xlab("total steps per day")

h3
```

This histogram is different from the one created eariler.


The mean is **`r round(mean(stepsbydate2$ttl.steps),0)`**.
The median is **`r round(median(stepsbydate2$ttl.steps),0)`**.

So, by imputing missing values by mean number of steps for an equivalant
interval pulled the mean up, but the median was not changed.

The last question is **"Are there differences in activity patterns
between weekdays and weekend?"**

Using the previously created data frame, **"meanbyinterval"**, which shows the mean steps for each interval across all 61 days, make a imputed list.

1.create a new column for interval mean for each interval (auto name = mean.steps)
2.create a new column which shows each interval's mean steps if steps  = NA (missing value), or else, leave as they are.

```{r, echo=TRUE,results='asis'}
imputed_wk <- activity %>%
  inner_join(meanbyinterval, by = "interval") %>%
  mutate(steps = ifelse(is.na(steps),mean.steps,steps)) %>%
  mutate(date = as.Date(date,"%Y-%m-%d")) %>%
  mutate(weekdays = as.factor(weekdays(date))) %>%
  mutate(weekdays.cat = as.factor(ifelse(weekdays %in% c("Saturday", "Sunday"),"weekend","weekday")))
```


Find how many days are weekdays
```{r, echo=TRUE,results='asis'}
weekdays <- imputed_wk %>%
  filter(weekdays.cat == "weekday")
unique(weekdays$weekdays)
length(unique(weekdays$date))
```

45 days are weekdays.

Find how many days are weekend
```{r, echo=TRUE,results='asis'}
weekend <- imputed_wk %>%
  filter(weekdays.cat == "weekend")
unique(weekend$weekdays)
length(unique(weekend$date))
```

16 days are weekend.

Create a data frame to include only weekend.

```{r, echo=TRUE,results='asis'}
weekend<- imputed_wk %>%
  filter(weekdays.cat == "weekend") %>%
  group_by(interval)%>%
  summarise(ttl.steps = sum(steps))%>% 
  mutate(avesteps = ttl.steps/16) %>%
  mutate(weekdays.cat = c("weekend"))
```

Create the one for weekdays and do the same.

```{r, echo=TRUE,results='asis'}
weekday<- imputed_wk %>%
  filter(weekdays.cat == "weekday") %>%
  group_by(interval)%>%
  summarise(ttl.steps = sum(steps))%>% 
  mutate(avesteps = ttl.steps/45) %>%
  mutate(weekdays.cat = c("weekday"))
```

Combine weekend and weekday dataframes and create an object, "all".

```{r, echo=TRUE,results='asis'}
all <- rbind(weekend, weekday)
```

Then create a panel plot containing a time series plot of the 5-minute interval(x-axis) and the average number of steps taken, across all weekday days or weekend days (y-axis).

```{r, echo=TRUE,results='asis'}
q4 <- ggplot(data = all,aes(x = interval, y = avesteps)) + 
  geom_line(size = 0.5,na.rm = TRUE) +
  facet_grid(weekdays.cat~.) +
  ylab("Average Numbers of Steps taken") +
  xlab("Interval")

q4
```